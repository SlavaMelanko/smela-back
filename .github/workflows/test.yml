name: Tests

on:
  pull_request:
    branches: [main, dev]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - '**.json'
      - '**.yml'
      - '!.github/workflows/test.yml'
      - '**.yaml'
      - 'LICENSE'
      - '.gitignore'
  push:
    branches: [main]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - '**.json'
      - '**.yml'
      - '!.github/workflows/test.yml'
      - '**.yaml'
      - 'LICENSE'
      - '.gitignore'

jobs:
  test:
    runs-on: ubuntu-latest
    container: oven/bun:latest
    environment: test
    env:
      LOG_LEVEL: ${{ vars.LOG_LEVEL }}
      DB_URL: ${{ secrets.DB_URL }}
      JWT_ACCESS_SECRET: ${{ secrets.JWT_ACCESS_SECRET }}
      COOKIE_NAME: ${{ vars.COOKIE_NAME }}
      COOKIE_DOMAIN: ${{ vars.COOKIE_DOMAIN }}
      BE_BASE_URL: ${{ vars.BE_BASE_URL }}
      FE_BASE_URL: ${{ vars.FE_BASE_URL }}
      EMAIL_SENDER_PROFILES: ${{ vars.EMAIL_SENDER_PROFILES }}
      EMAIL_ETHEREAL_HOST: ${{ vars.EMAIL_ETHEREAL_HOST }}
      EMAIL_ETHEREAL_PORT: ${{ vars.EMAIL_ETHEREAL_PORT }}
      EMAIL_ETHEREAL_USERNAME: ${{ vars.EMAIL_ETHEREAL_USERNAME }}
      EMAIL_ETHEREAL_PASSWORD: ${{ secrets.EMAIL_ETHEREAL_PASSWORD }}
      COMPANY_NAME: ${{ vars.COMPANY_NAME }}
      COMPANY_SOCIAL_LINKS: ${{ vars.COMPANY_SOCIAL_LINKS }}
      CAPTCHA_SECRET_KEY: ${{ secrets.CAPTCHA_SECRET_KEY }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: bun install

      - name: Run linting
        run: bun run lint

      - name: Run tests
        run: bun test
